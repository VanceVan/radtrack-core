<%= render :partial => 'shared/breadcrumbs' %>
<%= render :partial => 'kanban/new_card'%>

<div id="project_detail_tabs" style="float: left; width: 100%; display: none;">
  
  <ul>
    <li><a href="<%= project_backlog_tab_path(@project)%>" class="backlog_tab"><span><%= spinner %>&nbsp;Backlog / Horizon Planning</span></a></li>
    <li><a href="<%= project_kanban_tab_path(@project) %>" class="kanban_tab"><span><%= spinner %>&nbsp;Project Kanban</span></a></li>
    <li><a href="<%= project_mytasks_tab_path(@project) %>"><span><%= spinner %>&nbsp;My Tasks</span></a></li>
    <li><a id="members_tab" href="#members"><span>Team Members</span></a></li>
    <% beta_user? do %>
      <li><a href="#project-tools"><span>3rd Party Tools</span></a></li>
    <% end %>
  </ul>

  <div id="members" class="tab_content">
    <%= render :partial => 'users/index', :locals => {:users => @project.users} %>
  </div>

  <% beta_user? do %>


  <div id="project-tools">
    <div id="project-tools-tabs" style="float: left; width: 100%; height: 800px;">
      <ul>
		
	      <li><a href="#project-tools-1"><span>fluid IA</span></a></li>
	      <li><a href="#project-tools-3"><span>Workamajig</span></a></li>
	      <li><a href="#project-tools-2"><span>Dabbleboard</span></a></li>
      </ul>
      <div id="project-tools-1" width="100%;" height="100%;"><iframe src="http://www.fluidia.org/" width="98%" height="760px;"></iframe></div>
      <div id="project-tools-2" width="100%;" height="100%;"><iframe src="http://www.dabbleboard.com/" width="98%" height="760px;"></iframe></div>
      <div id="project-tools-3" width="100%;" height="100%;"><iframe src="http://www.workamajig.com" width="98%" height="760px;"></iframe></div>
    </div>
  </div>

  <% end %>

</div>

<% content_for :tail_javascript do %>
<script type="text/javascript">


$(function() {

  $.fn.UserTabs = function(options) {
		var defaults = {
		       tabs: [{ title:"Sample Tab", url:"http://www.fluidia.org" }]
		   };
		   var options = $.extend(defaults, options);

		var html = '';
	    html += '<div id="project-tools-tabs" style="float: left; width: 100%; height: 800px;">';
	
	    html += '<ul>';
	
		for (var i=0; i < options.tabs.length; i++) {
			var tab = options.tabs[i];
		}

		$(this).tabs({
		});

  }

  $('#project-tools-tabs').UserTabs();

  $('#project_detail_tabs').tabs({
    load: reload_cards,
    spinner: '',
    ajaxOptions: {success: function() {}}
  }).fadeIn(1000);


  function reload_cards(event, ui) {
    $(ui.panel).hide();
    $('.spinner', ui.tab).show();
    $.ajax({
      type: "GET",
      url: "<%= project_cards_path(@project) %>",
      dataType: "json",
      cache: false,
      success: function(json){
        // TOOD: Could optimize by only loading the tab panel that we're looking at
        $('#kanban', ui.panel).kanban({cards:json});
        $('#backlog', ui.panel).backlog({cards:json});
        $('.spinner', ui.tab).hide();
        $(ui.panel).fadeIn(1000);
      }
    });
  }

});
</script>

<% end %>
